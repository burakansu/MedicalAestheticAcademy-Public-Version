@model Package
@{
    int CookieCustomerId = MetaData.baseCustomerId();
    var Packages = MetaData.basePackage();
    var lessons = MetaData.baseLesson();
    var customerlesson = MetaData.baseCustomerLessonRelation();
    int haved = MetaData.baseCustomerPackageRelation().Where(x => x.CustomerId == CookieCustomerId && x.PackageId == Model.PackageId).Count();

    List<Basket> baskets = MetaData.baseBasket();
}

<div class="rbt-page-banner-wrapper">
    <!-- Start Banner BG Image  -->
    <div class="rbt-banner-image"></div>
    <!-- End Banner BG Image  -->
    <div class="rbt-banner-content">
        <!-- Start Banner Content Top  -->
        <div class="rbt-banner-content-top rbt-breadcrumb-style-3">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 offset-lg-2">
                        <div class="content text-center">

                            <h2 class="title theme-gradient">@Model.Name</h2>

                            <ul class="rbt-meta">
                                <li><i class="feather-calendar"></i>Son Güncelleme @Model.GuncellemeTarihi</li>
                                <li><i class="feather-globe"></i>Türkçe</li>
                                <li><i class="feather-award"></i>Onaylı Paket</li>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Banner Content Top  -->
    </div>
</div>

<div class="rbt-section-overlayping-top rbt-section-gapBottom">
    <div class="inner">
        <div class="container">
            <div class="col-lg-12">

                <div class="row row--30 gy-5 pt--60">

                    <div class="col-lg-4">
                        <div class="course-sidebar sticky-top rbt-shadow-box rbt-gradient-border">
                            <div class="inner">
                                <div class="content-item-content">
                                    <div class="rbt-price-wrapper d-flex flex-wrap align-items-center justify-content-between">
                                        <div class="rbt-price">
                                            <span class="current-price">@Model.Price @Model.Currency.Name</span>
                                        </div>
                                        <div class="discount-time">
                                            <span class="rbt-badge color-danger bg-color-danger-opacity">
                                                <i class="feather-clock"></i> Kısa Süreli!
                                            </span>
                                        </div>
                                    </div>

                                    @if (CookieCustomerId != 0)
                                    {
                                        @if (haved > 0)
                                        {
                                            <div class="buy-now-btn mt--15">
                                                <a class="rbt-btn btn-border icon-hover w-100 d-block text-center">
                                                    <span class="btn-text">Satın Alınmış</span>
                                                    <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                                                </a>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="add-to-card-button mt--15">
                                                <a id="AllBasket" class="rbt-btn btn-gradient icon-hover w-100 d-block text-center" href="#">
                                                    <span class="btn-text">Sepete Ekle</span>
                                                    <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                                                </a>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="buy-now-btn mt--15">
                                            <a asp-action="Index" asp-controller="LoginUi" class="rbt-btn btn-border icon-hover w-100 d-block text-center">
                                                <span class="btn-text">Giriş Yap</span>
                                                <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                                            </a>
                                        </div>
                                    }

                                    <span class="subtitle">
                                        <i class="feather-rotate-ccw"></i> Güvenli Ödeme
                                    </span>


                                    <div class="rbt-widget-details has-show-more">
                                        <ul class="has-show-more-inner-content rbt-course-details-list-wrapper">
                                            <li>
                                                <span>Kurslar</span><span class="rbt-feature-value rbt-badge-5">@Model.PackageCourseRelation.Count() Kurs</span>
                                            </li>
                                            <li><span>Danışmanlıklar</span><span class="rbt-feature-value rbt-badge-5">@Model.PackageAdvisorRelation.Count() Danışmanlık</span></li>
                                            <li><span>Pratik Dersler</span><span class="rbt-feature-value rbt-badge-5">@Model.PackagePracticeLessonRelation.Count() Pratik Ders</span></li>
                                        </ul>

                                    </div>

                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <!-- Start Course Details  -->
                        <div class="course-details-content">
                            <div class="rbt-inner-onepage-navigation sticky-top">
                                <nav class="mainmenu-nav onepagenav">
                                    <ul class="mainmenu">
                                        <li class="current">
                                            <a href="#overview">Paket Detayları</a>
                                        </li>
                                        <li>
                                            <a href="#coursecontent">Barındırılan Hizmetler</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>

                            <!-- Start Course Feature Box  -->
                            <div class="rbt-course-feature-box overview-wrapper rbt-shadow-box mt--30 has-show-more" id="overview">
                                <div class="rbt-course-feature-inner has-show-more-inner-content">
                                    <div class="section-title">
                                        <h4 class="rbt-title-style-3">Paket Açıklamaları</h4>
                                    </div>
                                    <p>
                                        @Model.Description
                                    </p>
                                </div>
                            </div>
                            <!-- End Course Feature Box  -->
                            <!-- Start Course Content  -->
                            <div class="course-content rbt-shadow-box coursecontent-wrapper mt--30" id="coursecontent">
                                <div class="rbt-course-feature-inner">
                                    <div class="section-title">
                                        <h4 class="rbt-title-style-3">Barındırılan Hizmetler</h4>
                                    </div>
                                    <div class="rbt-accordion-style rbt-accordion-02 accordion">
                                        <div class="accordion" id="accordionExampleb2">

                                            <div class="accordion-item card">
                                                <h2 class="accordion-header card-header" id="headingTwo1">
                                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo1" aria-expanded="true" aria-controls="collapseTwo1">
                                                        Kurslar <span class="rbt-badge-5 ml--10">@Model.PackageCourseRelation.Count() Kurs</span>
                                                    </button>
                                                </h2>
                                                <div id="collapseTwo1" class="accordion-collapse collapse show" aria-labelledby="headingTwo1" data-bs-parent="#accordionExampleb2">
                                                    <div class="accordion-body card-body pr--0">
                                                        <ul class="rbt-course-main-content liststyle">


                                                            @foreach (var item in Model.PackageCourseRelation)
                                                            {
                                                                <li class="col">
                                                                    <img class="col-sm-2 h-50" style="float:left; border-radius:10px;" src="@MetaData.baseAssetsPath()/Course/@item.Course.Image">
                                                                    <div class="card p-3 col-sm-10">
                                                                        <div class="card-header pb-3">
                                                                            <a class="h6 m-0" asp-action="Detail" asp-controller="CourseUi" asp-route-id="@item.Course.CourseId">
                                                                                <div class="course-content-left" style="max-width:420px;">
                                                                                    <i class="feather-play-circle"></i> <span class="text" style="text-overflow:ellipsis; overflow:hidden; white-space: nowrap;">@item.Course.Name</span>
                                                                                </div>
                                                                                <div class="course-content-right">
                                                                                    <span class="text ml-10">(@item.Course.PackageCourseRelation.Where(x=>x.PackageId == Model.PackageId).FirstOrDefault()?.StartDate.ToString("dd/MM/yyyy"))</span>
                                                                                    <span class="text ml-10">(@item.Course.PackageCourseRelation.Where(x=>x.PackageId == Model.PackageId).FirstOrDefault()?.FinishDate.ToString("dd/MM/yyyy"))</span>
                                                                                </div>
                                                                            </a>
                                                                        </div>
                                                                        <div class="card-body" style="overflow:hidden;">
                                                                            <span style ="text-overflow:ellipsis; overflow:hidden; white-space: nowrap;" class="text ml-10">@item.Course.Description</span>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                            }
                                                            

                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="accordion-item card">
                                                <h2 class="accordion-header card-header" id="headingTwo2">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo2" aria-expanded="false" aria-controls="collapseTwo2">
                                                        Pratik Dersler <span class="rbt-badge-5 ml--10">@Model.PackagePracticeLessonRelation.Count() Pratik Ders</span>
                                                    </button>
                                                </h2>
                                                <div id="collapseTwo2" class="accordion-collapse collapse" aria-labelledby="headingTwo2" data-bs-parent="#accordionExampleb2">
                                                    <div class="accordion-body card-body pr--0">
                                                        <ul class="rbt-course-main-content liststyle">


                                                            @foreach (var item in Model.PackagePracticeLessonRelation)
                                                            {
                                                                <li>
                                                                    <a href="#" @*asp-action="Detail" asp-controller="PracticeLessonUi" asp-route-id="@item.PracticeLesson.PracticeLessonId"*@>
                                                                        <div class="course-content-left">
                                                                            <i class="feather-info"></i> <span class="text">@item.PracticeLesson.Name</span><span style="margin-left:15px;">(@item.PracticeLesson.Date.ToShortDateString())</span>
                                                                        </div>
                                                                    </a>
                                                                    @item.PracticeLesson.Description
                                                                </li>
                                                            }


                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="accordion-item card">
                                                <h2 class="accordion-header card-header" id="headingTwo3">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo3" aria-expanded="false" aria-controls="collapseTwo3">
                                                        Danışmanlıklar <span class="rbt-badge-5 ml--10">@Model.PackageAdvisorRelation.Count() Danışmanlık</span>
                                                    </button>
                                                </h2>
                                                <div id="collapseTwo3" class="accordion-collapse collapse" aria-labelledby="headingTwo3" data-bs-parent="#accordionExampleb2">
                                                    <div class="accordion-body card-body pr--0">
                                                        <ul class="rbt-course-main-content liststyle">


                                                            @foreach (var item in Model.PackageAdvisorRelation)
                                                            {
                                                                <li>
                                                                    <a asp-action="Detail" asp-controller="AdvisorUi" asp-route-id="@item.AdvisorId">
                                                                        <div class="course-content-left">
                                                                            <i class="feather-info"></i> <span class="text">@item.Advisor.Name</span>
                                                                        </div>
                                                                    </a>
                                                                </li>
                                                            }


                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Course Content  -->
                        </div>
                        <!-- End Course Details  -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="rbt-separator-mid">
    <div class="container">
        <hr class="rbt-separator m-0">
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {

        $('#AllBasket').click(function (e) {
            e.preventDefault();

            var PackageId = @Model.PackageId;

            $.ajax({
                url: '/Basket/Save',
                type: 'POST',
                data: { packageid: PackageId },
                success: function (result) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Paket Sepete Eklendi',
                        showConfirmButton: false,
                        timer: 1500
                    })
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
            });
        });

    });
</script>